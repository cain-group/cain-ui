{"version":3,"file":"utils.js","sourceRoot":"","sources":["utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { VNode, defineComponent, getCurrentInstance, h, inject, ref, Ref } from 'vue';\n\nexport interface InputProps extends Object {\n  modelValue: string | boolean;\n}\n\nconst UPDATE_VALUE_EVENT = 'update:modelValue';\nconst MODEL_VALUE = 'modelValue';\nconst ROUTER_LINK_VALUE = 'routerLink';\nconst NAV_MANAGER = 'navManager';\nconst ROUTER_PROP_PREFIX = 'router';\n\n/**\n * Starting in Vue 3.1.0, all properties are\n * added as keys to the props object, even if\n * they are not being used. In order to correctly\n * account for both value props and v-model props,\n * we need to check if the key exists for Vue <3.1.0\n * and then check if it is not undefined for Vue >= 3.1.0.\n * See https://github.com/vuejs/vue-next/issues/3889\n */\nconst EMPTY_PROP = Symbol();\nconst DEFAULT_EMPTY_PROP = { default: EMPTY_PROP };\n\ninterface NavManager<T = any> {\n  navigate: (options: T) => void;\n}\n\nconst getComponentClasses = (classes: unknown) => {\n  return (classes as string)?.split(' ') || [];\n};\n\nconst getElementClasses = (ref: Ref<HTMLElement | undefined>, componentClasses: Set<string>, defaultClasses: string[] = []) => {\n  return [ ...Array.from(ref.value?.classList || []), ...defaultClasses ]\n    .filter((c: string, i, self) => !componentClasses.has(c) && self.indexOf(c) === i);\n};\n\n/**\n* Create a callback to define a Vue component wrapper around a Web Component.\n*\n* @prop name - The component tag name (i.e. `ion-button`)\n* @prop componentProps - An array of properties on the\n* component. These usually match up with the @Prop definitions\n* in each component's TSX file.\n* @prop customElement - An option custom element instance to pass\n* to customElements.define. Only set if `includeImportCustomElements: true` in your config.\n* @prop modelProp - The prop that v-model binds to (i.e. value)\n* @prop modelUpdateEvent - The event that is fired from your Web Component when the value changes (i.e. ionChange)\n* @prop externalModelUpdateEvent - The external event to fire from your Vue component when modelUpdateEvent fires. This is used for ensuring that v-model references have been\n* correctly updated when a user's event callback fires.\n*/\nexport const defineContainer = <Props>(\n  name: string,\n  defineCustomElement: any,\n  componentProps: string[] = [],\n  modelProp?: string,\n  modelUpdateEvent?: string,\n  externalModelUpdateEvent?: string\n) => {\n  /**\n  * Create a Vue component wrapper around a Web Component.\n  * Note: The `props` here are not all properties on a component.\n  * They refer to whatever properties are set on an instance of a component.\n  */\n\n  if (defineCustomElement !== undefined) {\n    defineCustomElement();\n  }\n\n  const Container = defineComponent<Props & InputProps>((props: any, { attrs, slots, emit }) => {\n    let modelPropValue = props[modelProp];\n    const containerRef = ref<HTMLElement>();\n    const classes = new Set(getComponentClasses(attrs.class));\n    const onVnodeBeforeMount = (vnode: VNode) => {\n      // Add a listener to tell Vue to update the v-model\n      if (vnode.el) {\n        const eventsNames = Array.isArray(modelUpdateEvent) ? modelUpdateEvent : [modelUpdateEvent];\n        eventsNames.forEach((eventName: string) => {\n          vnode.el.addEventListener(eventName.toLowerCase(), (e: Event) => {\n            modelPropValue = (e?.target as any)[modelProp];\n            emit(UPDATE_VALUE_EVENT, modelPropValue);\n\n            /**\n             * We need to emit the change event here\n             * rather than on the web component to ensure\n             * that any v-model bindings have been updated.\n             * Otherwise, the developer will listen on the\n             * native web component, but the v-model will\n             * not have been updated yet.\n             */\n            if (externalModelUpdateEvent) {\n              emit(externalModelUpdateEvent, e);\n            }\n          });\n        });\n      }\n    };\n\n    const currentInstance = getCurrentInstance();\n    const hasRouter = currentInstance?.appContext?.provides[NAV_MANAGER];\n    const navManager: NavManager | undefined = hasRouter ? inject(NAV_MANAGER) : undefined;\n    const handleRouterLink = (ev: Event) => {\n      const { routerLink } = props;\n      if (routerLink === EMPTY_PROP) return;\n\n      if (navManager !== undefined) {\n        let navigationPayload: any = { event: ev };\n        for (const key in props) {\n          const value = props[key];\n          if (props.hasOwnProperty(key) && key.startsWith(ROUTER_PROP_PREFIX) && value !== EMPTY_PROP) {\n            navigationPayload[key] = value;\n          }\n        }\n\n        navManager.navigate(navigationPayload);\n      } else {\n        console.warn('Tried to navigate, but no router was found. Make sure you have mounted Vue Router.');\n      }\n    }\n\n    return () => {\n      modelPropValue = props[modelProp];\n\n      getComponentClasses(attrs.class).forEach(value => {\n        classes.add(value);\n      });\n\n      const oldClick = props.onClick;\n      const handleClick = (ev: Event) => {\n        if (oldClick !== undefined) {\n          oldClick(ev);\n        }\n        if (!ev.defaultPrevented) {\n          handleRouterLink(ev);\n        }\n      }\n\n      let propsToAdd: any = {\n        ref: containerRef,\n        class: getElementClasses(containerRef, classes),\n        onClick: handleClick,\n        onVnodeBeforeMount: (modelUpdateEvent) ? onVnodeBeforeMount : undefined\n      };\n\n      /**\n       * We can use Object.entries here\n       * to avoid the hasOwnProperty check,\n       * but that would require 2 iterations\n       * where as this only requires 1.\n       */\n      for (const key in props) {\n        const value = props[key];\n        if (props.hasOwnProperty(key) && value !== EMPTY_PROP) {\n          propsToAdd[key] = value;\n        }\n      }\n\n      if (modelProp) {\n        /**\n         * If form value property was set using v-model\n         * then we should use that value.\n         * Otherwise, check to see if form value property\n         * was set as a static value (i.e. no v-model).\n         */\n        if (props[MODEL_VALUE] !== EMPTY_PROP) {\n          propsToAdd = {\n            ...propsToAdd,\n            [modelProp]: props[MODEL_VALUE]\n          }\n        } else if (modelPropValue !== EMPTY_PROP) {\n          propsToAdd = {\n            ...propsToAdd,\n            [modelProp]: modelPropValue\n          }\n        }\n      }\n\n      return h(name, propsToAdd, slots.default && slots.default());\n    }\n  });\n\n  Container.displayName = name;\n\n  Container.props = {\n    [ROUTER_LINK_VALUE]: DEFAULT_EMPTY_PROP\n  };\n\n  componentProps.forEach(componentProp => {\n    Container.props[componentProp] = DEFAULT_EMPTY_PROP;\n  });\n\n  if (modelProp) {\n    Container.props[MODEL_VALUE] = DEFAULT_EMPTY_PROP;\n    Container.emits = [UPDATE_VALUE_EVENT, externalModelUpdateEvent];\n  }\n\n  return Container;\n};\n"]}